# QDTS - Quadratic Distortion Tone Spectra

A SuperCollider UGen for synthesizing sounds using Auditory Distortion Products (ADPs) - perceptual "phantom tones" generated by the inner ear.

## What is QDTS?

When specific combinations of frequencies are played together, your auditory system generates additional perceived tones that aren't in the audio signal. QDTS calculates the precise amplitudes needed so these phantom tones form a desired harmonic spectrum.

Based on:
- Kendall, Haworth & Cádiz (2014). *Sound Synthesis with Auditory Distortion Products*. Computer Music Journal 38(4).
- Gutiérrez, Haworth & Cádiz (2024). *Generating Sonic Phantoms with Quadratic Difference Tone Spectrum Synthesis*. Computer Music Journal 47(3).

## Installation

1. Find your SuperCollider Extensions directory:
```supercollider
Platform.userExtensionDir
```

2. Create a folder called `QDTS` inside Extensions and copy these files:

```
Extensions/
└── QDTS/
    ├── QDTSSolver.scx      ← compiled plugin (or .so on Linux)
    ├── QDTSSolver.sc       ← from sc-classes/
    ├── QDTSSolver.schelp   ← from HelpSource/Classes/
    ├── QDTS.schelp         ← from HelpSource/Classes/
    └── QDTS_Guide.schelp   ← from HelpSource/Guides/
```

3. Recompile the class library: **Cmd+Shift+L** (macOS) or **Ctrl+Shift+L** (Linux/Windows)

4. Verify installation:
```supercollider
QDTSSolver.class;  // Should return: QDTSSolver
QDTS.class;        // Should return: QDTS
```

## Quick Start

```supercollider
s.boot;

// Basic QDTS synthesis
(
{
    var numPartials = 4;
    var carrierPitch = 1000;  // Base frequency (1-5 kHz optimal)
    var targetPitch = 100;    // Perceived pitch
    var targets = [1, 0.5, 0.33, 0.25];  // Sawtooth spectrum

    var amps = QDTSSolver.kr(numPartials, *targets);
    var freqs = (numPartials + 1).collect {|i| carrierPitch + (i * targetPitch) };
    var sines = (numPartials + 1).collect {|i| SinOsc.ar(freqs[i]) * amps[i] };

    Limiter.ar(sines.sum * 0.2, 0.9) ! 2
}.play;
)
```

## Usage

### QDTSSolver UGen

```supercollider
QDTSSolver.kr(numHarmonics, *targets)
```

**Inputs:**
- `numHarmonics`: Number of target harmonics (1-16)
- `targets`: Target harmonic amplitudes

**Outputs:** Array of `numHarmonics + 2` values:
- Solved amplitudes (normalized)
- Estimation error (last value, lower = better)

### QDTS Helper Class

```supercollider
// Presets
{ QDTS.sawtooth(8, 440).ar(0.2) ! 2 }.play;
{ QDTS.square(8, 440).ar(0.2) ! 2 }.play;
{ QDTS.triangle(8, 440).ar(0.2) ! 2 }.play;
```

## Important Notes

**Avoid zero targets** - causes solver instability. Always use minimum values:
```supercollider
var t0s = t0.max(0.01);
```

**Carrier pitch range** - optimal between 1-5 kHz (typically ~2.5 kHz)

**Use Limiter** - always wrap output for safety:
```supercollider
Limiter.ar(signal, 0.9)
```

**Loudspeakers preferred** - ADPs are easier to perceive over speakers than headphones

## Examples

See `examples/QDTS_examples.scd` for comprehensive examples including:
- Basic synthesis and SynthDefs
- Real-time parameter control
- Pattern integration
- Formant/vowel shaping
- Spectral envelopes
- Pitch glides and vibrato

## Credits

- Original Max/MSP implementation: Gutiérrez, E. and Cádiz, R.
- SuperCollider port: Marcin Pietruszewski
